generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum Role {
  admin
  barber
}

enum AppointmentRequestStatus {
  pending
  approved
  rejected
  cancelled
}

enum AppointmentSlotStatus {
  blocked
  free
}

model Barber {
  id           String   @id @default(cuid())
  name         String   @db.VarChar(255)
  email        String   @unique @db.VarChar(255)
  password     String   @db.VarChar(255)
  role         Role     @default(barber)
  experience   Int      @default(0)
  rating       Decimal  @default(5.00) @db.Decimal(3, 2)
  specialties  String?  @db.Text
  image       String?  @db.VarChar(500)
  slotDuration Int      @default(30)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now()) @db.DateTime(0)
  updatedAt    DateTime @updatedAt @db.DateTime(0)

  workingHours        WorkingHour[]
  appointmentRequests AppointmentRequest[]
  appointmentSlots    AppointmentSlot[]
  ledgerEntries       LedgerEntry[]

  @@index([email])
  @@map("barbers")
}

model WorkingHour {
  id        String   @id @default(cuid())
  barberId  String
  dayOfWeek Int
  startTime String   @db.VarChar(10)
  endTime   String   @db.VarChar(10)
  isWorking Boolean  @default(true)
  createdAt DateTime @default(now()) @db.DateTime(0)
  updatedAt DateTime @updatedAt @db.DateTime(0)

  barber Barber @relation(fields: [barberId], references: [id], onDelete: Cascade)

  @@unique([barberId, dayOfWeek])
  @@index([barberId])
  @@map("working_hours")
}

model AppointmentRequest {
  id                 String                   @id @default(cuid())
  barberId           String
  customerName       String                   @db.VarChar(255)
  customerPhone      String                   @db.VarChar(20)
  customerEmail      String?                  @db.VarChar(255)
  date               String                   @db.VarChar(191)
  requestedStartTime String                   @db.VarChar(191)
  requestedEndTime   String?                  @db.VarChar(191)
  status             AppointmentRequestStatus @default(pending)
  createdAt          DateTime                 @default(now()) @db.DateTime(0)

  barber           Barber            @relation(fields: [barberId], references: [id], onDelete: Cascade)
  appointmentSlots AppointmentSlot[]
  ledgerEntry      LedgerEntry?

  @@index([barberId, date])
  @@index([status])
  @@map("appointment_requests")
}

model AppointmentSlot {
  id                   String                @id @default(cuid())
  barberId             String
  appointmentRequestId String?               @db.VarChar(191)
  date                 String                @db.VarChar(191)
  startTime            String                @db.VarChar(191)
  endTime              String                @db.VarChar(191)
  status               AppointmentSlotStatus @default(blocked)
  createdAt            DateTime              @default(now()) @db.DateTime(0)

  barber             Barber              @relation(fields: [barberId], references: [id], onDelete: Cascade)
  appointmentRequest AppointmentRequest? @relation(fields: [appointmentRequestId], references: [id], onDelete: SetNull)

  @@index([barberId, date])
  @@index([barberId, date, status])
  @@index([status])
  @@map("appointment_slots")
}

model LedgerEntry {
  id                   String   @id @default(cuid())
  barberId             String
  appointmentRequestId String?  @unique
  date                 String   @db.VarChar(191)
  customerName         String   @db.VarChar(255)
  description          String?  @db.Text
  amount               Decimal  @db.Decimal(10, 2)
  createdAt            DateTime @default(now()) @db.DateTime(0)

  barber             Barber            @relation(fields: [barberId], references: [id], onDelete: Cascade)
  appointmentRequest AppointmentRequest? @relation(fields: [appointmentRequestId], references: [id], onDelete: SetNull)

  @@index([barberId, date])
  @@map("ledger_entries")
}
